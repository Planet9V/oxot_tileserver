# OXOT Geospatial Tileserver

> Self-contained Docker deployment for critical infrastructure visualization, cybersecurity geolocation, and operational technology situational awareness.

## What This Is

A standalone, persistent **vector tile server** that provides geospatial backend services for the OXOT Cyber Digital Twin platform. It ingests 22 open-data sources covering electric grids, water infrastructure, demographics, and telecoms across Europe, North America, Australia, and New Zealand -- then serves them as fast vector tiles via a REST API on port 8080.

Built for cybersecurity professionals, OT engineers, and infrastructure analysts who need to visualize critical infrastructure, map cyber attack origins, assess supply chain risks, and run simulation war games -- all on a self-hosted, air-gappable platform.

### Key Capabilities

- **22 open-data sources** across 5 domains (basemap, demographics, electric, water, telecoms)
- **12 cybersecurity use cases** with full implementation guides (attack mapping, IP geolocation, threat intelligence, supply chain, simulation)
- **76-page technical wiki** with 4 levels of depth, APA citations, glossary, and cross-linked navigation
- **5 installation options** (A-E) from lightweight demo (~5 GB) to full multi-region (~22 GB)
- **Docker-native** -- two containers: tileserver-gl (runtime) + converter (data processing)
- **Custom tile creation** -- bring your own GeoJSON for facilities, equipment, customers, sensors
- **MapLibre GL JS / Leaflet / OpenLayers / deck.gl** integration ready

---

## Quick Start

```bash
git clone https://github.com/Planet9V/OXOT_Tileserver_geospatial.git
cd OXOT_Tileserver_geospatial
cp .env.example .env

# Choose an installation option (A through E)
./options/option-e.sh    # Full multi-region build (recommended)

# Start tileserver
docker compose up -d

# Verify
curl http://localhost:8080/health
curl http://localhost:8080/index.json | jq '.[].id'
# Access tile viewer at http://localhost:8080
```

---

## Architecture

```
┌─────────────────────────────────────────────────────┐
│              Your Application (React, etc.)          │
│   MapLibre GL JS / Leaflet / OpenLayers / deck.gl   │
└──────────────────────┬──────────────────────────────┘
                       │ HTTP (vector tiles, TileJSON)
                       ▼
┌──────────────────────────────────────────────────────┐
│             tileserver-gl  (port 8080)               │
│   Serves .mbtiles + .pmtiles as vector tiles (PBF)  │
│   REST API: /{tileset}/{z}/{x}/{y}.pbf               │
└──────────────────────┬──────────────────────────────┘
                       │ reads from
                       ▼
┌──────────────────────────────────────────────────────┐
│                  data/tiles/                          │
│    *.mbtiles  |  *.pmtiles  (generated tile files)   │
└──────────────────────┬──────────────────────────────┘
                       │ generated by
                       ▼
┌──────────────────────────────────────────────────────┐
│         converter container (on-demand)               │
│   osmium | tippecanoe | ogr2ogr | pmtiles CLI        │
│   Downloads → Extracts → Converts → Loads            │
└──────────────────────────────────────────────────────┘
```

- **tileserver-gl**: Always-running runtime container on port 8080
- **converter**: Ephemeral tools container (runs only during data processing)
- **data/tiles/**: Persistent volume with generated tile files
- **data/raw/**: Intermediate downloads (can be deleted after conversion)

---

## Data Sources (22)

### Basemap (3 sources)
| Source | Coverage | Format | Size |
|--------|----------|--------|------|
| Protomaps Basemap | Global | PMTiles | ~15 GB (3-region) |
| OpenMapTiles / MapTiler | Global | MBTiles | ~80 GB (planet) |
| OpenFreeMap | Global | MBTiles | ~80 GB (planet) |

### Demographics (7 sources)
| Source | Coverage | What You Get |
|--------|----------|-------------|
| US Census TIGER/Line + ACS | US | Tracts, block groups + population, income, housing |
| Eurostat NUTS + Nuts2json | EU | NUTS 0/1/2/3 + population, GDP, employment |
| ABS Census Boundaries | AU | SA1-SA4 + census data |
| Stats NZ Boundaries | NZ | Meshblocks, area units + census |
| GeoNames cities15000 | Global | 25,000+ cities with population |
| Natural Earth Populated Places | Global | ~7,300 cities (coarse) |
| WorldPop | Global | 100m population grid raster |

### Electric Grid (6 sources)
| Source | Coverage | What You Get |
|--------|----------|-------------|
| OSM Power (Geofabrik) | Global | 7M+ km power lines, 1M+ substations |
| EIA US Energy Atlas | US | 10,000+ plants (fuel, capacity, owner) |
| HIFLD (DHS/CISA) | US | Multi-sector infrastructure |
| ENTSO-E / GridKit | EU | HV transmission >= 220 kV |
| Geoscience Australia | AU | Transmission >= 66 kV |
| [Awesome Grid Mapping](https://github.com/open-energy-transition/Awesome-Electrical-Grid-Mapping) | Global | Curated catalog of 150+ country grid datasets |

### Water Infrastructure (5 sources)
| Source | Coverage | What You Get |
|--------|----------|-------------|
| OSM Water Tags | Global | Treatment plants, reservoirs, dams |
| EPA SDWIS + WATERS | US | Community water systems + violations |
| EEA WISE | EU | River basins, water bodies |
| National Inventory of Dams | US | 92,075 dams with 70+ attributes |
| Australian BoM Water | AU | Storage, catchments, major dams |

### Telecoms (1 source)
| Source | Coverage | What You Get |
|--------|----------|-------------|
| OSM Telecoms | Global | 600K+ masts, 3,500+ data centers, fiber |

---

## Use Cases (12 Implementation Guides)

Each use case includes pre-conditions, data sources, conversion pipeline, MapLibre/deck.gl code, and integration steps.

| Use Case | Description | Key Data Sources |
|----------|-------------|------------------|
| [Cyber Attack Mapping](docs/wiki/13a-CYBER-ATTACK-MAPPING.md) | Visualize attack origins/destinations with arc layers | MaxMind, AbuseIPDB, GreyNoise |
| [IP Geolocation](docs/wiki/13a1-IP-GEOLOCATION.md) | Resolve IPs to coordinates with accuracy assessment | GeoLite2, GeoIP2, IP2Location |
| [Threat Intelligence Feeds](docs/wiki/13a2-THREAT-INTELLIGENCE-FEEDS.md) | Ingest IOCs from STIX/TAXII feeds | OTX, MISP, abuse.ch |
| [Facility & Building Location](docs/wiki/13b-FACILITY-BUILDING-LOCATION.md) | Map physical assets with 3D extrusion | Microsoft Buildings, Overture |
| [Socioeconomic Analysis](docs/wiki/13c-SOCIOECONOMIC-ANALYSIS.md) | Choropleth vulnerability overlays | CDC SVI, Census ACS, turf.js |
| [Geopolitical Events](docs/wiki/13d-GEOPOLITICAL-EVENTS.md) | Real-time event mapping | GDELT (15-min updates), ACLED |
| [Natural Hazards](docs/wiki/13d1-NATURAL-HAZARDS.md) | Earthquake, fire, flood overlays | USGS, NASA FIRMS, FEMA NFHL |
| [Supply Chain Mapping](docs/wiki/13e-SUPPLY-CHAIN-MAPPING.md) | Multi-hop chain visualization | UN Comtrade, Sourcemap |
| [Shipping & Logistics](docs/wiki/13e1-SHIPPING-ROUTES.md) | Vessel tracking and port analysis | MarineTraffic AIS, World Port Index |
| [Simulation & War Gaming](docs/wiki/13f-SIMULATION-WARGAMING.md) | Tabletop exercises with cascading failure | CISA CTEPs, turf.js blast radius |
| [Additional Use Cases](docs/wiki/13g-ADDITIONAL-USE-CASES.md) | Climate, insurance, regulatory, RF | Multiple |

---

## Installation Options

| Option | Description | Sources | Disk | Time |
|--------|-------------|---------|------|------|
| **A** | Quick Start -- global overview | 3 | ~5 GB | ~40 min |
| **B** | US Federal Authority -- HIFLD + Census | 5 | ~10 GB | ~3 hours |
| **C** | Modern + Comprehensive -- Overture + multi | 4 | ~16 GB | ~5 hours |
| **D** | Minimum Viable OXOT -- HIFLD + Census | 2 | ~8 GB | ~1.5 hours |
| **E** | **Multi-Region Full Coverage** (recommended) | 6 | ~22 GB | ~6 hours |

```bash
# Install your chosen option
./options/option-a.sh   # or option-b.sh through option-e.sh
docker compose up -d
```

---

## Custom Tile Creation

Create your own tile layers from any GeoJSON data:

```bash
# 1. Prepare GeoJSON (facilities, equipment, sensors, etc.)
cat > /tmp/my-facilities.geojson << 'EOF'
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": { "type": "Point", "coordinates": [-73.935, 40.730] },
      "properties": { "name": "Plant Alpha", "type": "manufacturing", "risk": "high" }
    }
  ]
}
EOF

# 2. Convert to tiles using the converter container
docker compose --profile tools run converter \
  tippecanoe -o /data/my-facilities.mbtiles \
  -l facilities -z14 -Z4 \
  /data/raw/my-facilities.geojson

# 3. Restart tileserver to pick up new tiles
docker compose restart tileserver

# 4. Verify
curl http://localhost:8080/data/my-facilities.json | jq .name
```

See the [Custom Tile Creation Guide](docs/wiki/07-CUSTOM-TILES.md) for full details including per-customer layers, equipment assets, and styling.

---

## Integration with Your Application

### MapLibre GL JS

```javascript
import maplibregl from 'maplibre-gl';

const map = new maplibregl.Map({
  container: 'map',
  style: 'http://localhost:8080/styles/infrastructure/style.json',
  center: [-98.5, 39.8],
  zoom: 4
});

// Add infrastructure overlay
map.addSource('infra', {
  type: 'vector',
  url: 'http://localhost:8080/data/osm-infrastructure.json'
});

map.addLayer({
  id: 'power-lines',
  type: 'line',
  source: 'infra',
  'source-layer': 'power_lines',
  paint: {
    'line-color': '#ff4444',
    'line-width': ['interpolate', ['linear'], ['zoom'], 4, 0.5, 14, 4],
    'line-opacity': 0.8
  }
});
```

### From OXOT Cyber DT or Any Backend

```env
TILESERVER_URL=http://localhost:8080
```

```javascript
// Fetch tile metadata
const res = await fetch(`${TILESERVER_URL}/data/osm-infrastructure.json`);
const tileJSON = await res.json();
// tileJSON.tiles = ["http://localhost:8080/data/osm-infrastructure/{z}/{x}/{y}.pbf"]
```

### REST API

```
GET /health                                    # Health check
GET /index.json                                # List all tilesets
GET /data/{tileset}/{z}/{x}/{y}.pbf            # Vector tile (PBF)
GET /data/{tileset}.json                       # TileJSON metadata
GET /styles/{style}/{z}/{x}/{y}.png            # Rendered raster tile
GET /styles/{style}/style.json                 # MapLibre style definition
```

---

## Directory Structure

```
OXOT_Tileserver_geospatial/
├── README.md                        # This file
├── docker-compose.yml               # Tileserver + converter containers
├── Dockerfile.converter             # Conversion tools (osmium, tippecanoe, GDAL)
├── .env.example                     # Environment configuration
├── config/
│   └── tileserver-config.json       # Tileserver-gl configuration
├── styles/
│   └── infrastructure.json          # MapLibre GL dark-theme infrastructure style
├── scripts/
│   ├── download.sh                  # Download data from sources
│   ├── extract-osm.sh              # Filter OSM PBF by tags
│   ├── convert.sh                   # Convert to MBTiles via tippecanoe
│   ├── load.sh                      # Load tiles into tileserver
│   └── update.sh                    # Periodic maintenance
├── options/
│   ├── option-a.sh                  # Quick Start (~5 GB)
│   ├── option-b.sh                  # US Federal (~10 GB)
│   ├── option-c.sh                  # Modern + Comprehensive (~16 GB)
│   ├── option-d.sh                  # Minimum Viable (~8 GB)
│   └── option-e.sh                  # Full Multi-Region (~22 GB)
├── sources/
│   └── README.md                    # Detailed source catalog (22 sources)
├── docs/
│   └── wiki/                        # 76-page technical wiki
│       ├── INDEX.md                 # Documentation home
│       ├── manifest.json            # Navigation tree (v1.2.0)
│       ├── 01-*.md                  # System overview (4 pages)
│       ├── 02-*.md                  # Data sources (22 pages)
│       ├── 03-*.md                  # Installation (5 pages)
│       ├── 04-*.md                  # Data pipeline (6 pages)
│       ├── 05-*.md                  # API reference (5 pages)
│       ├── 06-*.md                  # Integration guides (6 pages)
│       ├── 07-*.md                  # Custom tiles (6 pages)
│       ├── 08-*.md                  # Operations (5 pages)
│       ├── 09-GLOSSARY.md           # 55+ defined terms
│       ├── 10-REFERENCES.md         # APA citations (8 categories)
│       ├── 11-CHANGELOG.md          # Version history
│       └── 13-*.md                  # Use cases (12 pages)
└── data/
    ├── tiles/                       # Generated tiles (runtime)
    └── raw/                         # Downloaded sources (intermediate)
```

---

## Maintenance

```bash
# Update all sources for your option
./scripts/update.sh --option e

# Update a single source
./scripts/download.sh --source osm-infrastructure
./scripts/convert.sh --source osm-infrastructure
docker compose restart tileserver

# Check health
curl http://localhost:8080/health
docker compose logs tileserver --tail 20
```

### Cron Schedule

```cron
# Weekly OSM update (Sundays 2 AM)
0 2 * * 0 cd /path/to/OXOT_Tileserver_geospatial && ./scripts/update.sh --source osm-infrastructure
# Monthly basemap (1st of month 3 AM)
0 3 1 * * cd /path/to/OXOT_Tileserver_geospatial && ./scripts/update.sh --source basemap
# Annual census (January 15 4 AM)
0 4 15 1 * cd /path/to/OXOT_Tileserver_geospatial && ./scripts/update.sh --source demographics
```

---

## Documentation

The full 76-page wiki is available in [`docs/wiki/`](docs/wiki/INDEX.md):

| Section | Pages | Description |
|---------|-------|-------------|
| [01 System Overview](docs/wiki/01-OVERVIEW.md) | 4 | Architecture, stack, requirements |
| [02 Data Sources](docs/wiki/02-DATA-SOURCES.md) | 22 | All 22 sources with download/convert guides |
| [03 Installation](docs/wiki/03-INSTALLATION.md) | 5 | Docker setup, options A-E, environment |
| [04 Data Pipeline](docs/wiki/04-PIPELINE.md) | 6 | Download, extract, convert, load, maintain |
| [05 API Reference](docs/wiki/05-API.md) | 5 | REST endpoints, TileJSON, vector tiles |
| [06 Integration](docs/wiki/06-INTEGRATION.md) | 6 | MapLibre, Leaflet, OpenLayers, OXOT DT |
| [07 Custom Tiles](docs/wiki/07-CUSTOM-TILES.md) | 6 | GeoJSON authoring, customer layers, equipment |
| [08 Operations](docs/wiki/08-OPERATIONS.md) | 5 | Monitoring, troubleshooting, performance |
| [09 Glossary](docs/wiki/09-GLOSSARY.md) | 1 | 55+ defined terms |
| [10 References](docs/wiki/10-REFERENCES.md) | 1 | APA 7th edition citations |
| [13 Use Cases](docs/wiki/13-USE-CASES.md) | 12 | Cybersecurity, supply chain, simulation |

---

## License

Data sources have their own licenses (see [full license table](docs/wiki/10-REFERENCES.md)):

- **OpenStreetMap data**: ODbL
- **US Federal data** (Census, EIA, HIFLD, NID, EPA): Public Domain
- **Eurostat**: CC BY 4.0
- **GeoNames / Natural Earth**: CC BY 4.0 / Public Domain
- **Awesome Grid Mapping catalog**: CC0-1.0

This repository (scripts, configuration, documentation): **MIT License**

---

## Links

- [Protomaps Basemap Builds](https://maps.protomaps.com/builds/)
- [Geofabrik Downloads](https://download.geofabrik.de/)
- [Awesome Electrical Grid Mapping](https://github.com/open-energy-transition/Awesome-Electrical-Grid-Mapping)
- [EIA US Energy Atlas](https://atlas.eia.gov/)
- [HIFLD Open Data](https://hifld-geoplatform.opendata.arcgis.com/)
- [Tippecanoe](https://github.com/felt/tippecanoe)
- [Tileserver-GL](https://github.com/maptiler/tileserver-gl)
- [MapLibre GL JS](https://maplibre.org/maplibre-gl-js/docs/)
- [deck.gl](https://deck.gl/)
- [Open Infrastructure Map](https://openinframap.org/)
